import{a as I,r as c,ac as F,j as t}from"./vendor-Cp_li0RT.js";import{b as R,u as N,z as _,A as B,B as K,C as L,m as U,a as G,F as O,D as z,I as b,E as H,S as M,G as Y,P as $,H as q}from"./index-YWIOG9Yk.js";function J({onClose:D}){var k;const u=R(),{selectedTask:p,tags:S}=N(e=>e.tasks),m=N(e=>e.tasks.categories),[a,x]=c.useState(p),[g,f]=c.useState((p==null?void 0:p.progress)||{steps:[],totalSteps:0,allStepsComplete:!1}),[h,y]=c.useState("");c.useEffect(()=>{x(p),f(p.progress||{steps:[],totalSteps:0,allStepsCompleted:!1})},[p]);const d=c.useMemo(()=>F.debounce(async e=>{const s=e._id;await u(_({taskId:s,taskData:e})),await Promise.all([u(B()),u(K()),u(L())])},500),[u,p._id]),C=c.useCallback(e=>{const{name:s,value:o}=e.target,l={...a};if(s==="category")if(o==="no category")l[s]="";else{const n=m.find(r=>r.categoryName===o);l[s]=n||""}else l[s]=o;x(l),d(l)},[a,d,m,S]),T=c.useCallback(e=>{y(e.target.value)}),j=c.useCallback((e,s)=>{x(o=>{const l=e instanceof Date?e.toISOString():e,n={...o,[s]:l};return d(n),n})},[g,a,d]);c.useCallback(e=>{x(s=>{const l=Array.isArray(s.tag)&&s.tag.some(r=>typeof r=="string"?r===e:r._id===e._id)?[]:[e],n={...s,tag:l};return d(n),n})},[d]);const v=c.useCallback(e=>{e.key==="Enter"&&h.trim()!==""&&f(s=>{const o={label:h,completed:!1},l=[...s.steps||[],o],n={...s,steps:l,totalSteps:l.length,allStepsComplete:l.every(i=>i.completed)},r={...a,progress:n};return d(r),y(""),n})},[h,d,a]),w=c.useCallback(e=>{f(s=>{const o=s.steps.filter((r,i)=>i!==e),l={...s,steps:o,totalSteps:o.length,allStepsCompleted:o.length>0&&o.every(r=>r.completed)},n={...a,progress:l};return d(n),l})},[g,a,d]),E=c.useCallback(e=>{f(s=>{const o=s.steps.map((i,P)=>P===e?{...i,completed:!i.completed}:i),l=o.length>0&&o.every(i=>i.completed),n={...s,steps:o,allStepsCompleted:l},r={...a,progress:n};return console.log("Updated Progress for Step Completion:",n),d(r),n})},[g,a,d]),A=e=>{u(q(e))};return c.useEffect(()=>{u(U())},[u]),c.useEffect(()=>{console.log("Categories:",m),console.log("Tags:",S)},[m],[S]),c.useEffect(()=>()=>{d.cancel()},[d]),t.jsx(G,{children:t.jsx("div",{className:" w-[300px] md:w-[800px] p-1 rounded-2xl ",children:t.jsxs("div",{className:"bg-purpleSidebar p-6 rounded-xl",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("p",{className:"text-white text-xl",children:"TASK DETAILS"}),t.jsxs("div",{className:"flex items-center gap-6 ",children:[a.status==="failed"&&t.jsx(O,{onClick:e=>{e.preventDefault(),e.stopPropagation(),A(p._id)},icon:z,className:"text-white text-3xl cursor-pointer hover:rotate-[-360deg] transition-transform duration-300 ease-in"}),t.jsx("p",{className:`text-white md:text-xl ${a.status==="pending"?"pending":a.status==="failed"?"failed":"completed"} uppercase`,children:a.status})]})]}),t.jsxs("div",{className:"flex flex-col  ",children:[t.jsx("div",{className:"py-4",children:t.jsx(b,{type:"text",name:"title",placeholder:"Title",value:a.title,onChange:C,className:"text-3xl w-full border-none py-0"})}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-2 pb-4",children:[t.jsx(H,{name:"category",value:(k=a.category)==null?void 0:k.categoryName,entities:m,placeholder:"CATEGORY",handleInputChange:C,showTag:!1}),t.jsx(M,{id:"startDate",name:"startDate",selected:a.startDate,onChange:e=>j(e,"startDate"),placeholder:"START DATE"}),t.jsx(Y,{id:"deadline",name:"Deadline",selected:a.deadline,onChange:e=>j(e,"deadline"),placeholder:"DEADLINE"})]}),t.jsx("textarea",{type:"text",name:"note",placeholder:"Note",value:a.note,onChange:C,className:" scrollbar-custom w-full  text-xl text-white  bg-darkBackground rounded-lg p-2 px-4 focus:outline-none focus:border-purple-400"}),t.jsxs("div",{className:"flex flex-col gap-4 mt-4 mb-2",children:[t.jsx("div",{children:t.jsx(b,{type:"text",name:"progress",placeholder:"Enter a step ",value:h,onChange:T,onKeyDown:v,className:"text-xl w-full px-4 py-3 rounded-xl "})}),t.jsx("div",{className:"px-2",children:t.jsx($,{steps:g.steps,handleRemoveStep:w,handleStepComplete:E,showCompletion:!0})})]})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex flex-col gap-2",children:t.jsx("div",{className:"flex gap-2"})}),t.jsx("button",{className:"done-button mt-4",onClick:D,children:"Done"})]})]})})})}const W=I.memo(J);export{W as default};
